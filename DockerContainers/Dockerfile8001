FROM updated-ubuntu:latest
RUN apt install tor ufw openjdk-8-jdk -y
RUN apt install supervisor -y
RUN echo "HiddenServiceDir /var/lib/tor/" >> /etc/tor/torrc \
    && echo "HiddenServicePort 8001 127.0.0.1:8001" >> /etc/tor/torrc && service tor restart

ADD library-service/library-service-0.0.1-SNAPSHOT.jar /root/library-service.jar
#ADD library-service/keys/* /var/lib/tor/
RUN chown -R debian-tor:debian-tor /var/lib/tor/ && chmod 600 /var/lib/tor/* 
ADD library-service/supervisord.conf /etc/supervisor/conf.d/supervisord.conf

ENTRYPOINT ["/usr/bin/supervisord"]
